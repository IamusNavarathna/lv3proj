
pkg = Package()
pkg.InitGame()
pkg.LoadDependency("lostvikings_data")


class LVTestLevelSelectMenu from SinusMenu

    function Setup()
        self.Add( [Package.Start, [MyLoadMapScript, "test.fal"]], "Test Level" )
        self.Add( [Package.Start, [MyLoadMapScript, "demo.fal"]], "Demo Level" )
        self.Add( self.OnGoBack, "--- Back ---" )
    end
    
    function OnGoBack()
        Package.Shutdown()
    end
    
    function OnUpdate()
        sx, sy = Screen.GetSize()
        self.x = int((sx - self.totalW) / 2)
        self.y = int((sy - self.totalH) / 2)
    end

end

function MyLoadMapScript(file)
    pkg.InitScript("levels/" + file)
    pkg.LoadScripts("benchmark")
    CloseCurrentMenu()
end

function LoadFinal()
    OpenMenu(LVTestLevelSelectMenu)
end

function EscHandler()
    Package.Shutdown()
end

function RawKeyHandler(inp)
    ty, src, which, value = inp
    if(ty == EVENT_TYPE_KEYBOARD and value)
        if(which == SDLK.ESCAPE)
            EscHandler()
        end
    end
end

function CenterView(who)
    w = Screen.GetWidth()
    h = Screen.GetHeight()
    x = who.x - (w >> 1)
    y = who.y - (h >> 1)
    Screen.SetCamera(x, y)
end

pkg.Start(LoadFinal)
RegisterRawInputHook(RawKeyHandler)


export CenterView
